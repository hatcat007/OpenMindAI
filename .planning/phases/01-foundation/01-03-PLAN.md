---
phase: 01-foundation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [
  "package.json",
  "tsconfig.json",
  "tsup.config.ts",
  ".gitignore",
  "README.md"
]
autonomous: true
must_haves:
  truths:
    - "Package can be installed via npm install"
    - "Build produces valid output in dist/"
    - "TypeScript compiles without errors"
    - "Package exports work for both ESM and CommonJS consumers"
    - "Zero configuration works out of the box"
  artifacts:
    - path: "package.json"
      provides: "NPM package configuration"
      min_lines: 50
      contains: ["name: opencode-brain", "@opencode-ai/plugin", "bun:sqlite"]
    - path: "tsconfig.json"
      provides: "TypeScript compiler configuration"
      min_lines: 20
      contains: ["module: ESNext", "target: ES2022", "strict: true"]
    - path: "tsup.config.ts"
      provides: "Build configuration"
      min_lines: 20
      contains: ["format: [\"esm\"]", "@opencode-ai/plugin"]
    - path: ".gitignore"
      provides: "Git ignore patterns"
      min_lines: 10
      contains: ["node_modules", "dist", ".opencode/mind.mv2"]
    - path: "README.md"
      provides: "Installation and usage documentation"
      min_lines: 60
      contains: ["npm install opencode-brain", "opencode.json"]
  key_links:
    - from: "package.json"
      to: "tsup.config.ts"
      via: "build script references tsup"
      pattern: "tsup|build"
    - from: "package.json"
      to: "tsconfig.json"
      via: "TypeScript configuration"
      pattern: "typescript|tsc"
---

<objective>
Set up NPM package structure, build configuration, and documentation for opencode-brain.

Purpose: Without proper packaging, users cannot install the plugin. Without documentation, users cannot use it.
Output: Complete npm package ready for publishing or local installation.
</objective>

<execution_context>
@/Users/buddythacat/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/buddythacat/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/research/STACK.md ‚Äî Section "Build Configuration" and "Plugin Distribution"

# Reference: Prior plans
# Plan 01 provides: src/storage/* ‚Äî storage layer
# Plan 02 provides: src/index.ts, src/plugin.ts, src/config.ts ‚Äî plugin implementation
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NPM Package Configuration</name>
  <files>package.json, .gitignore</files>
  <action>
    Create package.json for opencode-brain NPM package.
    
    Required fields:
    ```json
    {
      "name": "opencode-brain",
      "version": "0.1.0",
      "description": "Memory persistence for Opencode - remember everything across sessions",
      "main": "dist/index.js",
      "module": "dist/index.js",
      "types": "dist/index.d.ts",
      "type": "module",
      "exports": {
        ".": {
          "import": "./dist/index.js",
          "types": "./dist/index.d.ts"
        }
      },
      "files": ["dist/", "opencode.json", "README.md"],
      "scripts": {
        "build": "tsup",
        "dev": "tsup --watch",
        "typecheck": "tsc --noEmit",
        "lint": "eslint src/",
        "test": "bun test",
        "prepublishOnly": "npm run build"
      },
      "keywords": ["opencode", "plugin", "memory", "ai", "coding"],
      "author": "Your Name",
      "license": "MIT",
      "engines": {
        "bun": ">=1.0.0"
      },
      "peerDependencies": {
        "@opencode-ai/plugin": ">=1.0.0"
      },
      "dependencies": {
        "@opencode-ai/plugin": "latest"
      },
      "devDependencies": {
        "@types/bun": "latest",
        "typescript": "^5.7.0",
        "tsup": "^8.0.0",
        "eslint": "^9.0.0",
        "@typescript-eslint/eslint-plugin": "^8.0.0"
      }
    }
    ```
    
    Also create .gitignore:
    ```
    node_modules/
    dist/
    .DS_Store
    *.log
    .env
    .env.local
    .opencode/mind.mv2
    .opencode/mind.mv2.lock
    coverage/
    *.tmp
    ```
    
    Important notes:
    1. "type": "module" for ESM-only
    2. Bun as primary engine (not Node.js)
    3. @opencode-ai/plugin as peer dependency
    4. No @memvid/sdk (we're using SQLite instead)
    5. Include opencode.json in published files
  </action>
  <verify>
    Validate package.json:
    bun run -e "const pkg = await import('./package.json', { assert: { type: 'json' } }); console.log('Name:', pkg.default.name); console.log('Has build script:', !!pkg.default.scripts?.build);"
    
    Verify .gitignore exists and has key patterns:
    grep -E "(node_modules|dist|mind.mv2)" .gitignore
  </verify>
  <done>
    package.json is valid JSON with correct name, exports, and scripts; .gitignore excludes build artifacts and memory files
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TypeScript and Build Configuration</name>
  <files>tsconfig.json, tsup.config.ts</files>
  <action>
    Create TypeScript and build configuration for Bun compatibility.
    
    tsconfig.json:
    ```json
    {
      "compilerOptions": {
        "target": "ES2022",
        "module": "ESNext",
        "moduleResolution": "bundler",
        "lib": ["ES2022"],
        "strict": true,
        "esModuleInterop": true,
        "skipLibCheck": true,
        "forceConsistentCasingInFileNames": true,
        "declaration": true,
        "declarationMap": true,
        "sourceMap": true,
        "outDir": "./dist",
        "rootDir": "./src",
        "resolveJsonModule": true,
        "isolatedModules": true,
        "noUnusedLocals": true,
        "noUnusedParameters": true,
        "noImplicitReturns": true,
        "noFallthroughCasesInSwitch": true
      },
      "include": ["src/**/*"],
      "exclude": ["node_modules", "dist", "**/*.test.ts"]
    }
    ```
    
    tsup.config.ts:
    ```typescript
    import { defineConfig } from "tsup";
    
    export default defineConfig({
      entry: ["src/index.ts"],
      format: ["esm"],
      platform: "node",
      target: "node18",  // Bun compatible
      bundle: true,
      splitting: false,
      sourcemap: true,
      clean: true,
      dts: true,
      external: [
        "@opencode-ai/plugin",  // Peer dependency
        "bun:sqlite"           // Built-in Bun module
      ],
      esbuildOptions(options) {
        options.banner = {
          js: "#!/usr/bin/env bun",
        };
      }
    });
    ```
    
    Key decisions:
    1. ESM-only (no CommonJS)
    2. Bun-compatible target
    3. Externalize @opencode-ai/plugin (provided by host)
    4. Externalize bun:sqlite (built-in module)
    5. Generate declaration files for TypeScript consumers
  </action>
  <verify>
    Validate configurations:
    bun run tsc --noEmit
    
    If TypeScript not installed yet, at least verify JSON validity:
    bun run -e "JSON.parse(await Bun.file('./tsconfig.json').text()); console.log('tsconfig.json valid');"
    bun run -e "const cfg = await import('./tsup.config.ts'); console.log('tsup config loads');"
  </verify>
  <done>
    TypeScript configuration validates and tsup config loads without errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Create README and Installation Documentation</name>
  <files>README.md</files>
  <action>
    Create comprehensive README.md for opencode-brain.
    
    Structure:
    ```markdown
    # Opencode Brain

    Memory persistence for Opencode. Remember everything across sessions without user effort.

    ## Features

    - ‚ú® Automatic memory capture (tool use, file changes, errors)
    - üîç Search with `/mind search <query>`
    - üìä View statistics with `/mind stats`
    - üí¨ Natural language queries with `/mind ask`
    - üîí 100% local storage (no cloud)
    - ‚ö° Zero configuration (works out of the box)

    ## Installation

    ```bash
    npm install opencode-brain
    ```

    Add to your `opencode.json`:

    ```json
    {
      "plugin": ["opencode-brain"]
    }
    ```

    The plugin auto-initializes on first run.

    ## Commands

    - `/mind stats` ‚Äî Show memory statistics
    - `/mind search <query>` ‚Äî Search memories
    - `/mind ask <question>` ‚Äî Query with natural language
    - `/mind recent` ‚Äî Show recent sessions
    - `/mind timeline` ‚Äî View session history

    ## Configuration

    Optional configuration in `opencode.json`:

    ```json
    {
      "plugin": ["opencode-brain"],
      "opencode-brain": {
        "storagePath": ".opencode/mind.mv2",
        "autoInitialize": true,
        "debug": false
      }
    }
    ```

    ## Storage Location

    By default, memories are stored in `.opencode/mind.mv2` (SQLite format).
    This file should be added to your `.gitignore`.

    ## Privacy

    - All data stored locally in your project directory
    - No external APIs or cloud services
    - Sensitive data filtering (passwords, .env files)
    - User controls what gets captured

    ## Requirements

    - Bun >= 1.0.0
    - Opencode >= 1.0.0

    ## License

    MIT
    ```
    
    Also include sections (can be brief for now):
    - Architecture overview
    - Development setup
    - Contributing
    - Troubleshooting
    - Migration from claude-brain (Phase 4)
  </action>
  <verify>
    Verify README exists and has key sections:
    grep -E "(Installation|npm install|opencode.json|/mind stats|Features)" README.md
    
    Check for critical information:
    - Installation instructions present
    - Configuration example shown
    - Commands listed
    - Storage location documented
    - Privacy note included
  </verify>
  <done>
    README includes installation, configuration, commands, and storage documentation
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. [ ] package.json is valid and has all required fields
2. [ ] TypeScript configuration compiles without errors
3. [ ] Build configuration produces valid output
4. [ ] .gitignore excludes appropriate files
5. [ ] README documents installation and usage
6. [ ] Package can theoretically be published to npm
</verification>

<success_criteria>
- package.json has correct name, version, exports, and scripts
- TypeScript configuration uses ES2022/ESNext with strict mode
- Build configuration externalizes @opencode-ai/plugin and bun:sqlite
- .gitignore excludes node_modules, dist, and mind.mv2 files
- README documents: installation, configuration, commands, storage, privacy
- Package structure follows npm best practices
- Zero configuration works (no required setup beyond npm install + opencode.json)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`

Include in SUMMARY:
- Package configuration decisions
- Build toolchain choices
- Dependencies and peer dependencies
- Documentation completeness
- Any deviations from planned approach
</output>
